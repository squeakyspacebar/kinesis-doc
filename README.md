This is the repository for housing/generating the documentation for Kinesis.

## Notes and Instructions

### Rebuild Table of Contents

This process uses:
- [GNU sed](https://www.gnu.org/software/sed/)

1. Grab the sidebar HTML generated by Hugo and convert it into markdown.
2. Replace the existing ToC hierarchy in `content/00-table-of-contents.md` with the newly generated one and save the changes to file.
> **Note:** Don't forget to remove the top Table of Contents link.
3. Run the following regex processing and write the results back to file:
```
indent=4;
sed -r "s/\s{$indent}/  /g" content/00-table-of-contents.md \
  | sed -r 's/\*\s+\*\s+/  - /g' \
  | sed -r 's/\*\s+/- /g' \
  | sed -r 's/\/kinesis-doc\///g' \
  | tee content/00-table-of-contents.md
```
4. Don't forget to rebuild the site with the `hugo` command.

### Build PDF

This process uses:
- [GNU sed](https://www.gnu.org/software/sed/)
- [Pandoc](https://pandoc.org/)

1. Create a working directory and build output directory:
    `mkdir -p .generate/.working .generate/.build`

2. Create shortcut to allow access to images:
    `ln -s $PWD/assets/images .generate/.working/images`

3. Copy markdown files to working directory:
    `cp $PWD/content/[^_]*.md .generate/.working/`

4. Enter working directory (pandoc runs from the current working directory):
    `cd .generate/.working`

5. Process each markdown files, convert them to HTML files, insert page break elements, then create the PDF:

   ````
   FILES=([^_]*.md)
   FILECOUNT=${#FILES[@]}
   LASTFILE=${FILES[${#FILES[*]}]}
   for f in "${FILES[@]}"
   do
   sed -i -E 's/([0-9]{2}-[^#]*)//g' ${f}
   OUTPUT_FILENAME="`basename "${f}" .md`.html"
   pandoc ${f} -f markdown-implicit_figures -t html -o $OUTPUT_FILENAME
   if [[ ${f} != $LASTFILE ]]
   then
   echo "${f} is not $LASTFILE"
   echo '<div style="page-break-after: always"></div>' >> $OUTPUT_FILENAME
   fi
   done
   pandoc *.html -t html5 --css ../../assets/css/print.css -o ../.build/kinesis-doc.pdf
   ````
